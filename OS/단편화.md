# 메모리 단편화

RAM에서 메모리의 공간이 작은 조각으로 나뉘어저 사용가능한 메모리가 충분히 존재하지만 할당(사용)이 불가능한 상태를 메모리 단편화가 발생했다고 한다. 메모리 단편화는 내부 단편화와 외부 단편화로 구분 가능하다.

## 내부 단편화(Internal Fragmentation)

주기억장치 내 사용자 영역이 실행 프로그램보다 커서 프로그램의 사용 공간을 할당 후 사용도지 않고 남게 되는 현상

![image](https://github.com/Ahrang777/CS-Study/assets/100702397/5e6f1073-d147-4edb-a6de-d8561f1af7d7)


100mb 메모리에 80mb 프로세스를 올리게 되면 20mb의 내부 단편화가 발생하게 된다.
즉, 적은 크기의 잔여 메모리가 발생해 해당 메모리를 사용할 수 없게 된다.
또한 프로세스는 실제로 사용하지 않는 메모리 영역을 가지고 있게 된다.

## 외부 단편화(External Fragmentation)

남아있는 총 메모리 공간이 요청한 메모리 공간보다 크지만, 남아있는 공간이 연속적이지 않아 발생하는 현상

![image](https://github.com/Ahrang777/CS-Study/assets/100702397/646d7b2f-27e5-4e1c-a8d5-d0343611f252)


남아 있는 메모리 공간은 50mb, 50mb로 총 100mb이고, 요청한 메모리 공간은 80mb으로 남아있는 메모리 공간이 더 크지만 연속적이지 않아 process c를 할당할 수 없게 된다.
따라서 남아있는 메모리 공간이 낭비되게 되는 문제가 발생한다.

## 외부 단편화 해결 방법

### 1. 압축

주기억 장치 내 분산되어 있는 단편화된 공간들을 통합하여 하나의 커다란 빈 공간을 만드는 작업

![image](https://github.com/Ahrang777/CS-Study/assets/100702397/bf28bfb0-0633-44ad-8cb8-d0f6211a639a)
![image](https://github.com/Ahrang777/CS-Study/assets/100702397/b638a3a8-ee80-4917-824e-0c1cad8f741b)


위와 같이 외부 단편화 현상에 대해서 흩어져 있던 공간을 메모리 재배치를 통해 연속된 공간, 즉 하나의 공간으로 만들면 기존에 할당할 수 없던 프로세스를 할당할 수 있게 된다.

### 2. 통합

단편화로 인해 분산된 메모리 공간들 중 인접해 있는 공간끼리 통합시켜 큰 메모리 공간으로 합치는 방법
압축은 재배치가 일어나지만 통합은 인접한 공간끼리 합해진다는 차이가 있다.

### 3. 페이징

하나의 프로세스가 사용하는 메모리 공간이 연속적이어야 한다는 제약을 없앤 메모리 관리 방법이다.

프로세스가 점유하는 `논리 메모리를 같은 크기의 블록으로 나눈 것을 페이지(page)`라고 하고, `주기억장치를 페이지와 같은 크기로 나눈 것을 프레임(frame)`이라고 한다.

![image](https://github.com/Ahrang777/CS-Study/assets/100702397/28dca790-d45b-4bcb-b4ee-d5b7a7834b3b)


프로세스의 가상 메모리를 `고정 크기`의 블록인 페이지 단위로 분할하여 물리 메모리에 할당함으로써, 논리 메모리는 물리 메모리에 저장될 때 연속되어 저장될 필요가 없어지고, 물리 메모리의 남는 프레임에 적절히 배치되기 때문에 외부 단편화를 해결할 수 있다.

따라서 하나의 프로세스가 사용하는 공간은 논리 메모리에서 여러 개의 페이지로 나뉘어서 관리 되고, 개별 페이지는 순서에 상관 없이 물리 메모리에 있는 프레임에 mapping 되어 저장된다고 볼 수 있다.

#### 단점

내부 단편화 문제의 비중이 늘어나게 된다. 예를 들어 페이지의 크기가 1,024B이고 프로세스 A의 크기가 3,172B라면 3개의 페이지 프레임(1,024 \* 3 = 3,072) 하고도 100B가 남기 때문에 총 4개의 페이지 프레임이 필요하다. 따라서 네 번째 페이지 프레임에는 924B의 여유 공간이 남게 되는 내부 단편화 문제가 발생할 수 있다.

## 내부 단편화 해결 방법

### 1. 세그멘테이션

프로세스의 가상 메모리를 `서로 다른 크기`의 블록인 세그먼트(segment) 단위로 분할하여 물리 메모리에 할당하는 기법

프로세스의 크기가 동적으로 변하는 경우에 효율적으로 메모리를 할당할 수 있어 내부 단편화를 해결할 수 있다.

#### 단점

서로 다른 크기의 세그먼트들이 메모리에 적재되고 제거되는 일이 반복되다 보면, 자유 공간들이 많은 수의 작은 조각들로 나누어져 못쓰게 될 수도 있다. 따라서 이 문제는 외부 단편화로 이어질 수 있다.
